<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">    
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/snackbar.min.css" />
    <link rel="stylesheet" href="assets/css/wrap.css" />
    <link rel="stylesheet" href="assets/css/mobile.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      body {
        background: #eee url('assets/img/bg.jpg') no-repeat bottom right fixed;
        background-position-y: 20px;
      }
      .snackbar {
        background: rgba(0, 23, 52, 0.8);
        padding: 7px;
        color: #fff;
      }
      .inputShadow:focus {
        -webkit-box-shadow: inset 0 -2px 0 rgba(0, 23, 52, 0.9) !important;
        box-shadow: inset 0 -2px 0 rgba(0, 23, 52, 0.9) !important;
        background-color: #fafafa !important;
      }
    </style>
  </head>

  <body onload="init()">

    <div id="launcherPage" data-role="page"></div>

    <div id="loginPage" data-role="page" class="container loginPage">

      <div class="row" style="margin-left: 0;margin-right: 0;">
        <div class="col-xs-12 headerLogo">
          <div class="col-xs-6">
            <img src="assets/img/sspm_logo.png" class="img img-responsive headerImg" alt="logo" />
          </div>
          <div class="col-xs-6">
            <p class="headerText">
              Sistema de Control de
              <span style="color: rgba(0, 23, 52, 0.8);font-size: 24px;font-weight: 600;"> Infracciones de Transito</span>
            </p>
          </div>
        </div>
        <div class="col-xs-12">
            <div class="wrap">
                <form class="login" id="formLogin" role="form">
                  <input type="text" name="NombreUsuario" id="NombreUsuario" class="form-control inputShadow" placeholder="Introduzca su nombre de usuario" />
                  <input type="password" name="Contrasena" id="Contrasena" class="form-control inputShadow" placeholder="Introduzca su contraseña" />
                  <input type="hidden" name="Imei" id="Imei" />
                  <input type="hidden" name="Latitud" id="latitude" />
                  <input type="hidden" name="Longitud" id="longitude" />
                  <input type="submit" class="btn btn-sm btn-primary" value="Iniciar sesión" id="submitSesion"/>
                </form>
            </div>
        </div>
      </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="cordova.js" type="text/javascript"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/snackbar.min.js"></script>
    <script src="assets/js/geolocation.js"></script>

    <script type="text/javascript" charset="utf-8">
      document.addEventListener("deviceready", onDeviceReady, false);
      function onDeviceReady() {
        var element = document.getElementById('Imei');
        element.value = device.uuid;
      }
    </script>

    <script type="text/javascript">
      $(function() {
        $('#submitSesion').on('click touch', function(event) {
        
          event.preventDefault();       
          
          var dataLogin = $('#formLogin').serialize();

          $.ajax({
            method: 'POST',
            url: 'http://soporte.policiatijuana.gob.mx:88/Api/Default1/',
            async: true,
            crossDomain: true,
            data: dataLogin,
            cache: false,
            beforeSend: function(){ $("#submitSesion").val('Iniciando...'); },
            success: function(data) {           
              $("body").load("home.html").hide().fadeIn(1500).delay(6000);
              window.location.href = "home.html";
            },
            error : function(xhr, textStatus, errorThrown ) {
              if (textStatus == 'timeout') {
                this.tryCount++;
                if (this.tryCount <= this.retryLimit) {
                  $.ajax(this);
                  return;
                }            
                return;
              }  
              $("#submitSesion").val('Iniciar sesión');       
              if (xhr.status == 500) {
                $.snackbar({
                  content: "Ocurrio un error, no desistas e intentalo nuevamente", 
                  timeout: 5000
                }); 
              } else {
                $.snackbar({
                  content: "Ocurrio un error, no desistas e intentalo nuevamente", 
                  timeout: 5000
                }); 
              }
            }
          });

          return false; 
        });
      });
    </script>

  </body>
</html>